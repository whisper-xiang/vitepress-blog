# 分支管理

## 现状

- 分支管理：

  1. 分支混乱，且发布分支太过随意，功能 B 分支未拉取已发布的功能 A 分支代码， 导致线上的分支 A 的功能丢失。
  2. 未建立合理 PR 流程，导致功能分支越来越多。
  3. 未有合理的 Tag，导致在代码层面没有版本概念。

- 环境
  1. dev
  2. test
  3. pro

## 方案

- `master`分支

  1.  主分支，用于部署生产环境的分支，是所有分支的主干，与当前线上代码保持统一
  2.  由主开发人员、研发组 leader 管控
  3.  不允许开发者在该分支上直接开发

- `dev`分支：

  1.  开发分支，开发各类功能的合并分支，即当前最新功能的分支
  2.  项目按功能模块创建 dev-xxx 分支(xxx 表示**功能**的简单描述)，各人员开发完成后提交到`dev`分支，主开发人员审核后，合并到 dev 分支
  3.  一般预发布分支从此分支拉取创建
  4.  不允许开发者在该分支上直接开发

- `feature`分支

  1.  功能分支，一般为 开发独立功能/新技术研究尝试 时创建，以 feature-xxx 命名(xxx 表示**功能**的简单描述)
  2.  从`master`/`dev`分支上面分出来的，开发完成，合并回去之后，删除该分支
  3.  开发周期较长时，建议定期拉取代码，避免长时间不更新，提交时冲突过多

- `release`分支

  1.  预发布分支，发布正式版本之前（即合并到`master`分支之前），用来进行测试，以`release-xxx`命名(xxx 表示**功能**的简单描述)
  2.  从 dev 分支拉取代码创建，如出现`bug`，则从`release`分支拉取`fixbug`分支，进行修复
  3.  很多公司忽略该分支，直接提交到`master`进行发布，可根据公司情况进行选择
  4.  不允许开发者在该分支上开发

- `fixbug`分支

  1.  `bug`修复分支，修复完成之后，合并到`master`/`release`分支上，并删除该分支
  2.  常规`bug`，以 `bugfix_xxx` 命名。xxx 表示 bug 的简单描述。
  3.  紧急`bug`， 以 `hotfix_xxx` 命名。xxx 表示 bug 的简单描述

- `tag`标签

  1.  每次从`master`发布生产环境后，用 tag 标记一个版本，在 master 分支上的每个 tag 都对应历史的一个线上版本
  2.  tag 命名：  
      v 主版本号.子版本号.阶段版本号.日期版本号\_软件阶段  
      v1.0.0.051021_beta  
      v1.0.0.061021_release
  3.  基于 tag 创建 GitHub Release， 用来记录发布版本的详细信息
